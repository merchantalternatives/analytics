<!DOCTYPE html>
<html>
<head>
    <title>Test Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
</head>
<body>
    <h1>Testing Data Load</h1>
    <div id="results"></div>
    
    <script>
    console.log('Script starting...');
    const resultsDiv = document.getElementById('results');
    
    Promise.all([
        fetch('data/clickstream.csv').then(r => r.text()),
        fetch('data/shortlinks.csv').then(r => r.text())
    ]).then(([clickstreamText, shortlinksText]) => {
        console.log('Files fetched');
        
        Papa.parse(clickstreamText, {
            header: true,
            complete: function(clickResults) {
                const clickstreamData = clickResults.data.filter(row => row['Short link']);
                console.log('Clickstream rows:', clickstreamData.length);
                
                Papa.parse(shortlinksText, {
                    header: true,
                    complete: function(linkResults) {
                        const shortlinksData = linkResults.data.filter(row => row.short_url);
                        console.log('Shortlinks rows:', shortlinksData.length);
                        
                        // Create lookup map
                        const shortlinkMap = {};
                        shortlinksData.forEach(link => {
                            shortlinkMap[link.short_url] = link;
                        });
                        
                        // Find matches
                        let matches = 0;
                        let sampleMatches = [];
                        clickstreamData.forEach(click => {
                            if (shortlinkMap[click['Short link']]) {
                                matches++;
                                if (sampleMatches.length < 5) {
                                    sampleMatches.push(click['Short link']);
                                }
                            }
                        });
                        
                        resultsDiv.innerHTML = `
                            <p>Clickstream entries: ${clickstreamData.length}</p>
                            <p>Shortlinks entries: ${shortlinksData.length}</p>
                            <p>Matching entries: ${matches}</p>
                            <p>Sample matches: ${sampleMatches.join(', ') || 'None'}</p>
                            <p>First few clickstream URLs: ${clickstreamData.slice(0, 3).map(c => c['Short link']).join(', ')}</p>
                            <p>First few shortlink URLs: ${shortlinksData.slice(0, 3).map(s => s.short_url).join(', ')}</p>
                        `;
                    }
                });
            }
        });
    }).catch(error => {
        console.error('Error:', error);
        resultsDiv.innerHTML = 'Error loading data: ' + error;
    });
    </script>
</body>
</html>