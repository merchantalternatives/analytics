<!DOCTYPE html>
<html>
<head>
    <title>Test Table Update</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Testing Table Loading</h1>
    
    <table id="links-table">
        <thead>
            <tr>
                <th>Short URL</th>
                <th>Name</th>
                <th>Clicks</th>
                <th>Type</th>
                <th>Top Source</th>
                <th>Top Country</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="6" style="text-align: center; color: #999;">
                    <div class="loading-spinner" style="margin: 20px auto;"></div>
                    <div>Loading analytics data...</div>
                </td>
            </tr>
        </tbody>
    </table>
    
    <div id="log" style="background: #f0f0f0; padding: 10px; margin-top: 20px;">
        <h3>Console Log:</h3>
        <pre id="console-log"></pre>
    </div>
    
    <script>
    // Override console.log to show on page
    const logDiv = document.getElementById('console-log');
    const originalLog = console.log;
    console.log = function(...args) {
        originalLog(...args);
        logDiv.textContent += args.join(' ') + '\n';
    };
    
    console.log('Page loaded, starting data fetch...');
    
    // Load the actual analytics.js script
    const script = document.createElement('script');
    script.src = 'analytics.js';
    script.onload = () => console.log('analytics.js loaded');
    script.onerror = () => console.log('Failed to load analytics.js');
    document.body.appendChild(script);
    
    // Also manually test the table update after a delay
    setTimeout(() => {
        const tbody = document.querySelector('#links-table tbody');
        console.log('Checking table after 5 seconds...');
        console.log('Table HTML:', tbody ? tbody.innerHTML.substring(0, 100) : 'tbody not found');
        if (tbody && tbody.innerHTML.includes('Loading')) {
            console.log('Still showing loading, manually replacing...');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: red; font-weight: bold;">MANUALLY REPLACED - No data found</td></tr>';
        }
    }, 5000);
    </script>
</body>
</html>